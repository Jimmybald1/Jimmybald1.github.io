<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>IBB Stats Calculator</title>
        <meta name="description" content="Unofficial Calculator for IBB Ball Upgrades">
        <!--<meta name="viewport" content="width=device-width, initial-scale=1" />-->

        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/nav-bar.css">
        <link rel="stylesheet" href="css/table.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    </head>
    <script type="text/javascript">
        var settings = {
            "prestige_speed": 3.3,
            "prestige_power": 11.3,
            "prestige_ballCost": -66,
            "prestige_speedCost": -66,
            "prestige_powerCost": -66,
    
            "cards_speed_value": 2,
            "cards_speed_active": true,
            "cards_power_value": 4,
            "cards_power_active": true,
            "cards_qc_value": 5,
            "cards_qc_active": true,
            "cards_spec_value": 4,
            "cards_spec_active": true,
            "cards_catalyst_value": 5.5,
            "cards_catalyst_active": true,
            "cards_shieldpen_value": 20,
            "cards_shieldpen_active": true,
    
            "perks_speed": 4,
            "perks_power": 4,
            "perks_ballCost": -60,
            "perks_speedCost": -60,
            "perks_powerCost": -60,
    
            "boosts_ph": true,
    
            "badges_basic": 400,
            "badges_sniper": 400,
            "badges_splash": 400,
            "badges_poison": 400,
            "badges_demo": 400,
            "badges_scatter": 400,
            "badges_pierce": 400,
            "badges_cash": 400,
            "badges_sword": 400,
            "badges_fire": 400,
            "badges_lightning": 400,
    
            "skillstree_poison_speed": 1.15,
            "skillstree_poison_enrage": 2,
            "skillstree_demo_enrage": 3,
            "skillstree_lightning_power": 1.4,
            "skillstree_lightning_speed": 1.1,
        };
    
        var tabs = {
            "base_type": null,
            "base_amount": 0,
            "base_speedLevel": 0,
            "base_powerLevel": 0,
    
            "175_type": null,
            "175_amount": 0,
            "175_speedLevel": 0,
            "175_powerLevel": 0,
    
            "7500_type": "poison",
            "7500_amount": 50,
            "7500_speedLevel": 99,
            "7500_powerLevel": 115,
    
            "175k_type": null,
            "175k_amount": 0,
            "175k_speedLevel": 0,
            "175k_powerLevel": 0,
    
            "15m_type": "cash",
            "15m_amount": 50,
            "15m_speedLevel": 99,
            "15m_powerLevel": 103,
    
            "400b_type": null,
            "400b_amount": 0,
            "400b_speedLevel": 0,
            "400b_powerLevel": 0,
    
            "10q_type": "sword",
            "10q_amount": 5,
            "10q_speedLevel": 71,
            "10q_powerLevel": 71,
    
            "10s_type": "lightning",
            "10s_amount": 50,
            "10s_speedLevel": 40,
            "10s_powerLevel": 51,
    
            "100o_type": "demo",
            "100o_amount": 25,
            "100o_speedLevel": 25,
            "100o_powerLevel": 25,
    
            "5aa_type": null,
            "5aa_amount": 0,
            "5aa_speedLevel": 0,
            "5aa_powerLevel": 0,
    
            "80ac_type": null,
            "80ac_amount": 0,
            "80ac_speedLevel": 0,
            "80ac_powerLevel": 0
        };
    
        var slots = [
            "base",
            "175",
            "7500",
            "175k",
            "15m",
            "400b",
            "10q",
            "10s",
            "100o",
            "5aa",
            "80ac"
        ];
    
        var basestats = {
            "base": {
                "basic": {
                    "speed": 1.0000,
                    "power": 1.00
                }
            },
            "175": {
                "sniper": {
                    "speed": 1.3750,
                    "power": 4.20
                },
                "splash": {
                    "speed": 0.8250,
                    "power": 4.00
                }
            },
            "7500": {
                "sniper": {
                    "speed": 1.5000,
                    "power": 15.75
                },
                "splash": {
                    "speed": 0.9000,
                    "power": 15.00
                },
                "poison": {
                    "speed": 1.0800,
                    "power": 1.50
                },
                "demo": {
                    "speed": 0.5400,
                    "power": 300.00
                }
            },
            "175k": {
                "sniper": {
                    "speed": 1.6250,
                    "power": 63.00
                },
                "splash": {
                    "speed": 0.9750,
                    "power": 60.00
                },
                "poison": {
                    "speed": 1.1700,
                    "power": 1.65
                },
                "demo": {
                    "speed": 0.5850,
                    "power": 1200.00
                },
                "scatter": {
                    "speed": 1.3000,
                    "power": 60.00
                }
            },
            "15m": {
                "sniper": {
                    "speed": 1.7500,
                    "power": 210.00
                },
                "splash": {
                    "speed": 1.0500,
                    "power": 200.00
                },
                "poison": {
                    "speed": 1.2600,
                    "power": 1.85
                },
                "demo": {
                    "speed": 0.6300,
                    "power": 4000.00
                },
                "scatter": {
                    "speed": 1.4000,
                    "power": 200.00
                },
                "pierce": {
                    "speed": 1.4000,
                    "power": 200.00
                },
                "cash": {
                    "speed": 1.5400,
                    "power": 0.35
                }
            },
            "400b": {
                "sniper": {
                    "speed": 1.9375,
                    "power": 945.00
                },
                "splash": {
                    "speed": 1.1625,
                    "power": 900.00
                },
                "poison": {
                    "speed": 1.3950,
                    "power": 2.10
                },
                "demo": {
                    "speed": 0.6975,
                    "power": 18000.00
                },
                "scatter": {
                    "speed": 1.5500,
                    "power": 900.00
                },
                "pierce": {
                    "speed": 1.5500,
                    "power": 900.00
                },
                "cash": {
                    "speed": 1.7050,
                    "power": 0.39
                },
                "sword": {
                    "speed": 1.9375,
                    "power": 1170.00
                },
                "fire": {
                    "speed": 1.9375,
                    "power": 900.00
                },
                "lightning": {
                    "speed": 1.3175,
                    "power": 900.00
                }
            },
            "10q": {
                "sniper": {
                    "speed": 2.1875,
                    "power": 2730.00
                },
                "splash": {
                    "speed": 1.3125,
                    "power": 2600.00
                },
                "poison": {
                    "speed": 1.5750,
                    "power": 2.35
                },
                "demo": {
                    "speed": 0.7875,
                    "power": 52000.00
                },
                "scatter": {
                    "speed": 1.7500,
                    "power": 2600.00
                },
                "pierce": {
                    "speed": 1.7500,
                    "power": 2600.00
                },
                "cash": {
                    "speed": 1.9250,
                    "power": 0.43
                },
                "sword": {
                    "speed": 2.1875,
                    "power": 3380.00
                },
                "fire": {
                    "speed": 2.1875,
                    "power": 2600.00
                },
                "lightning": {
                    "speed": 1.4875,
                    "power": 2600.00
                }
            },
            "10s": {
                "sniper": {
                    "speed": 2.3750,
                    "power": 12600.00
                },
                "splash": {
                    "speed": 1.4250,
                    "power": 12000.00
                },
                "poison": {
                    "speed": 1.7100,
                    "power": 2.70
                },
                "demo": {
                    "speed": 0.8550,
                    "power": 240000.00
                },
                "scatter": {
                    "speed": 1.9000,
                    "power": 12000.00
                },
                "pierce": {
                    "speed": 1.9000,
                    "power": 12000.00
                },
                "cash": {
                    "speed": 2.0900,
                    "power": 0.50
                },
                "sword": {
                    "speed": 2.3750,
                    "power": 15600.00
                },
                "fire": {
                    "speed": 2.3750,
                    "power": 12000.00
                },
                "lightning": {
                    "speed": 1.6150,
                    "power": 12000.00
                }
            },
            "100o": {
                "sniper": {
                    "speed": 2.5625,
                    "power": 84000.00
                },
                "splash": {
                    "speed": 1.5375,
                    "power": 80000.00
                },
                "poison": {
                    "speed": 1.8450,
                    "power": 3.10
                },
                "demo": {
                    "speed": 0.9225,
                    "power": 1600000.00
                },
                "scatter": {
                    "speed": 2.0500,
                    "power": 80000.00
                },
                "pierce": {
                    "speed": 2.0500,
                    "power": 80000.00
                },
                "cash": {
                    "speed": 2.2550,
                    "power": 0.58
                },
                "sword": {
                    "speed": 2.5625,
                    "power": 104000.00
                },
                "fire": {
                    "speed": 2.5625,
                    "power": 80000.00
                },
                "lightning": {
                    "speed": 1.7425,
                    "power": 80000.00
                }
            },
            "5aa": {
                "sniper": {
                    "speed": 2.7500,
                    "power": 756000.00
                },
                "splash": {
                    "speed": 1.6500,
                    "power": 720000.00
                },
                "poison": {
                    "speed": 1.9800,
                    "power": 3.25
                },
                "demo": {
                    "speed": 0.9900,
                    "power": 14400000.00
                },
                "scatter": {
                    "speed": 2.200,
                    "power": 720000.00
                },
                "pierce": {
                    "speed": 2.200,
                    "power": 720000.00
                },
                "cash": {
                    "speed": 2.4200,
                    "power": 0.65
                },
                "sword": {
                    "speed": 2.7500,
                    "power": 936000.00
                },
                "fire": {
                    "speed": 2.7500,
                    "power": 720000.00
                },
                "lightning": {
                    "speed": 1.8700,
                    "power": 720000.00
                }
            },
            "80ac": {
                "sniper": {
                    "speed": 2.9375,
                    "power": 6050000.00
                },
                "splash": {
                    "speed": 1.7625,
                    "power": 5760000.00
                },
                "poison": {
                    "speed": 2.1150,
                    "power": 3.40
                },
                "demo": {
                    "speed": 1.0575,
                    "power": 115200000.00
                },
                "scatter": {
                    "speed": 2.3500,
                    "power": 5760000.00
                },
                "pierce": {
                    "speed": 2.3500,
                    "power": 5760000.00
                },
                "cash": {
                    "speed": 2.5850,
                    "power": 0.69
                },
                "sword": {
                    "speed": 2.9375,
                    "power": 7490000.00
                },
                "fire": {
                    "speed": 2.9375,
                    "power": 5760000.00
                },
                "lightning": {
                    "speed": 1.9975,
                    "power": 5760000.00
                }
            }
        };
    
        var speedbasestats = {
            "basic": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "sniper": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "splash": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "poison": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "demo": {
                "increment": 0.33039,
                "modifier": 0.99446999
            },
            "scatter": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "pierce": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "cash": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "sword": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "fire": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
            "lightning": {
                "increment": 0.62787,
                "modifier": 0.9944711
            },
        };
    
        var powerbasestats = {
            "basic": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "sniper": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "splash": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "poison": {
                "increment": 0.434783,
                "modifier": 0.9925
            },
            "demo": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "scatter": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "pierce": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "cash": {
                "increment": 0.434783,
                "modifier": 0.9967
            },
            "sword": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "fire": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
            "lightning": {
                "increment": 1.00969,
                "modifier": 1.00997
            },
        };
    
        var basecosts = {
            "base": {
                "buy": 0,
                "ball": 6,
                "speed": 6,
                "power": 10
            },
            "175": {
                "buy": 175,
                "ball": 175,
                "speed": 200,
                "power": 200
            },
            "7500": {
                "buy": 7500,
                "ball": 7500,
                "speed": 7500,
                "power": 7500
            },
            "175k": {
                "buy": 175e3,
                "ball": 175e3,
                "speed": 175e3,
                "power": 175e3
            },
            "15m": {
                "buy": 15e6,
                "ball": 15e6,
                "speed": 15e6,
                "power": 15e6
            },
            "400b": {
                "buy": 400e9,
                "ball": 400e9,
                "speed": 400e9,
                "power": 400e9
            },
            "10q": {
                "buy": 10e15,
                "ball": 10e15,
                "speed": 10e15,
                "power": 10e15
            },
            "10s": {
                "buy": 10e21,
                "ball": 10e21,
                "speed": 10e21,
                "power": 10e21
            },
            "100o": {
                "buy": 100e27,
                "ball": 100e27,
                "speed": 100e27,
                "power": 100e27
            },
            "5aa": {
                "buy": 5e36,
                "ball": 5e36,
                "speed": 5e36,
                "power": 5e36
            },
            "80ac": {
                "buy": 80e42,
                "ball": 80e42,
                "speed": 80e42,
                "power": 80e42
            }
        }
		
		var brickmult = [
			{
				"level": 1,
				"mult": 1,
				"cumulative": 1,
			},
			{
				"level": 75,
				"mult": 1.2,
				"cumulative": 1.2,
			},
			{
				"level": 100,
				"mult": 1.25,
				"cumulative": 1.5,
			},
			{
				"level": 150,
				"mult": 1.4,
				"cumulative": 2.1,
			},
			{
				"level": 200,
				"mult": 1.5,
				"cumulative": 3.15,
			},
			{
				"level": 250,
				"mult": 1.6,
				"cumulative": 5.04,
			},
			{
				"level": 300,
				"mult": 1.7,
				"cumulative": 8.568,
			},
			{
				"level": 400,
				"mult": 1.8,
				"cumulative": 15.4224,
			},
			{
				"level": 500,
				"mult": 2,
				"cumulative": 30.8448,
			},
			{
				"level": 750,
				"mult": 2.5,
				"cumulative": 77.112,
			},
			{
				"level": 1000,
				"mult": 2.5,
				"cumulative": 192.78,
			},
			{
				"level": 1500,
				"mult": 2.5,
				"cumulative": 481.95,
			},
			{
				"level": 2500,
				"mult": 3,
				"cumulative": 1445.85,
			},
			{
				"level": 5000,
				"mult": 3,
				"cumulative": 4337.55,
			},
			{
				"level": 7500,
				"mult": 3.5,
				"cumulative": 15181.425,
			},
			{
				"level": 10000,
				"mult": 3.5,
				"cumulative": 53134.9875,
			},
			{
				"level": 15000,
				"mult": 4,
				"cumulative": 212539.95,
			},
			{
				"level": 20000,
				"mult": 4,
				"cumulative": 850159.8,
			},
			{
				"level": 25000,
				"mult": 4,
				"cumulative": 3400639.2,
			},
			{
				"level": 30000,
				"mult": 4,
				"cumulative": 13602556.8,
			},
			{
				"level": 40000,
				"mult": 4,
				"cumulative": 54410227.2,
			},
			{
				"level": 50000,
				"mult": 4,
				"cumulative": 217640908.8,
			},
			{
				"level": 75000,
				"mult": 4,
				"cumulative": 870563635.2,
			},
			{
				"level": 100000,
				"mult": 5,
				"cumulative": 4352818176,
			},
			{
				"level": 125000,
				"mult": 6,
				"cumulative": 26116909056,
			},
			{
				"level": 150000,
				"mult": 7,
				"cumulative": 182818363392,
			},
			{
				"level": 175000,
				"mult": 8,
				"cumulative": 1462546907136,
			},
			{
				"level": 200000,
				"mult": 9,
				"cumulative": 13162922164224,
			},
		]
    
        //StoreItem("settings", JSON.stringify(settings));
        settings = GetItem("settings", settings);
        //StoreItem("statsCalculator", JSON.stringify(tabs));
        tabs = GetItem("statsCalculator", tabs);

        var totalcost = 0;
    
        function GetItem(key, obj) {
            var json = window.localStorage.getItem(key);
            if (json === undefined || json === null) {
                StoreItem(key, JSON.stringify(obj));
            }
            else {
                obj = JSON.parse(json);
            }
    
            console.log(obj);
            return obj;
        }
    
        function StoreItem(key, text) {
            window.localStorage.setItem(key, text);
        }
    
        function FormatNumber(num) {
            const lookup = [
                { value: 1, symbol: "" },
                { value: 1e3, symbol: "K" },
                { value: 1e6, symbol: "M" },
                { value: 1e9, symbol: "B" },
                { value: 1e12, symbol: "T" },
                { value: 1e15, symbol: "q" },
                { value: 1e18, symbol: "Q" },
                { value: 1e21, symbol: "s" },
                { value: 1e24, symbol: "S" },
                { value: 1e27, symbol: "O" },
                { value: 1e30, symbol: "N" },
                { value: 1e33, symbol: "D" },
                { value: 1e36, symbol: "aa" },
                { value: 1e39, symbol: "ab" },
                { value: 1e42, symbol: "ac" },
                { value: 1e45, symbol: "ad" },
                { value: 1e48, symbol: "ae" },
                { value: 1e51, symbol: "af" },
                { value: 1e54, symbol: "ag" },
                { value: 1e57, symbol: "ah" },
                { value: 1e60, symbol: "ai" },
                { value: 1e63, symbol: "aj" },
                { value: 1e66, symbol: "ak" },
                { value: 1e69, symbol: "al" },
                { value: 1e72, symbol: "am" },
                { value: 1e75, symbol: "an" },
                { value: 1e78, symbol: "ao" },
                { value: 1e81, symbol: "ap" },
                { value: 1e84, symbol: "aq" },
                { value: 1e87, symbol: "ar" },
                { value: 1e90, symbol: "as" },
                { value: 1e93, symbol: "at" },
                { value: 1e96, symbol: "au" },
                { value: 1e99, symbol: "av" },
                { value: 1e102, symbol: null },
            ];

            var item = lookup.slice().reverse().find(function (item) {
                return num >= item.value;
            });
    
            if (item === undefined) {
                return 0;
            }
    
            if (item.symbol === null) {
                return item.value.toExponential(2);
            }
    
            return item ? (num / item.value).toFixed(2) + item.symbol : "0";
        }
    
        function handleCalculatorChange(event) {
            var element = event.target;
            var value = element.value;
            console.log(tabs[element.id], value);
    
            if (element.id.includes("type")) {
                tabs[element.id] = value;
            }
            else {
                tabs[element.id] = parseInt(value);
            }
    
            StoreItem("statsCalculator", JSON.stringify(tabs));
            BuildStatsCalculator();
        }
    
        function handleSettingsChange(event) {
            var element = event.target;
            var value = element.value;
    
            if (element.id.includes("active") || element.id.includes("boosts")) {
                console.log(settings[element.id], element.checked);
                settings[element.id] = element.checked;
            }
            else {
                console.log(settings[element.id], parseFloat(value));
                settings[element.id] = parseFloat(value);
            }
    
            StoreItem("settings", JSON.stringify(settings));
            BuildStatsCalculator();
        }
    
        //function BuildSettings() {
        //    for (var key in settings) {
        //        if (key.includes("active") || key.includes("boosts")) {
        //            $('#' + key).prop('checked', settings[key]);
        //        }
        //        else {
        //            $('#' + key).val(settings[key]);
        //        }
        //    }
        //}
    
        function BuildStatsCalculator() {
            // Calculator
            for (var key in tabs) {
                $('#' + key).val(tabs[key]);
            }
    
            totalcost = 0;
            for (var i in slots) {
                CalculateRow(slots[i]);
            }

            $('#totalcost').html(FormatNumber(totalcost));
            
            // Mini-Settings
            for (var key in settings) {
                if (key.includes("active") || key.includes("boosts")) {
                    $('#' + key).prop('checked', settings[key]);
                }
                else {
                    $('#' + key).val(settings[key]);
                }
            }
        }
    
        function CalculateRow(slot) {
            var balltype = tabs[slot + "_type"];
            if (balltype === null || balltype === "null") {
                $('#' + slot + '_speed').html("");
                $('#' + slot + '_power').html("");
                $('#' + slot + '_cost').html("");
                $('#' + slot + '_dmg_poison').html("");
                $('#' + slot + '_1shot_brick').html("");
                $('#' + slot + '_1shot_hex').html("");
                $('#' + slot + '_1shot_shield').html("");
                return;
            }
    
            // Speed
			var speed = CalculateSpeed(balltype, slot);
            $('#' + slot + '_speed').html(speed.toFixed(2));
    
            // Power
			var power = CalculatePower(balltype, slot);
            $('#' + slot + '_power').html(FormatNumber(power));
    
            // Cost
			var cost = CalculateCost(slot);
			$('#' + slot + '_cost').html(FormatNumber(cost));
            totalcost += cost;
			
			// Damage with x Poison
			var damage = null;
			if (balltype !== "poison" && balltype !== "cash") {
				damage = CalculateDamageWithPoison(power);
				if (damage !== null) {
					$('#' + slot + '_dmg_poison').html(FormatNumber(damage));
				}
				else {
					damage = power;
				}
			}
			
			// Last 1 shots.			
			if (balltype !== "poison" && balltype !== "cash") {
				// Green bricks
				var bricklevel = CalculateLastBrickLevel(damage);
				$('#' + slot + '_1shot_brick').html(bricklevel.toLocaleString("en-US", {minimumFractionDigits: 0, maximumFractionDigits: 0}));
				
				// Hex bricks
				var hexlevel = CalculateLastBrickLevel(damage / 25);
				$('#' + slot + '_1shot_hex').html(hexlevel.toLocaleString("en-US", {minimumFractionDigits: 0, maximumFractionDigits: 0}));
				
				// Shield Hex bricks
				var shielddamage = damage / 25 / (500 / ((settings["cards_shieldpen_active"]) ? settings["cards_shieldpen_value"] : 1));
				if (balltype === "sword") {
					shielddamage = damage / 25;
				}				
				var shieldlevel = CalculateLastBrickLevel(shielddamage);
				$('#' + slot + '_1shot_shield').html(shieldlevel.toLocaleString("en-US", {minimumFractionDigits: 0, maximumFractionDigits: 0}));
			}
        }
		
		function CalculateSpeed(balltype, slot) {		
            var increment = speedbasestats[balltype]["increment"];
            var modifier = speedbasestats[balltype]["modifier"];
            var basestat = basestats[slot][balltype]["speed"];
            var speedLevel = tabs[slot + '_speedLevel'];
    
            var speedBase = (increment * speedLevel * (Math.pow(modifier, speedLevel))) + basestat;
            var speed = (speedBase * settings["prestige_speed"]
                * ((settings["cards_speed_active"]) ? settings["cards_speed_value"] : 1)
                * ((settings["cards_qc_active"]) ? 0.5 : 1)
                * ((settings["perks_speed"] > 1) ? settings["perks_speed"] : 1)
                * ((speedLevel > 40) ? 0.4 : 1)
                * ((speedLevel > 80) ? 0.4 : 1)
                * SkillsTreeModifier(balltype, "speed")
                * SkillsTreeModifier(balltype, "enrage"));
			return speed;
		}
		
		function CalculatePower(balltype, slot) {			
            var increment = powerbasestats[balltype]["increment"];
            var modifier = powerbasestats[balltype]["modifier"];
            var basestat = basestats[slot][balltype]["power"];
            var speedLevel = tabs[slot + '_speedLevel'];
            var powerLevel = tabs[slot + '_powerLevel'];
    
            var powerBase = (1
                + (increment * powerLevel * (Math.pow(modifier, powerLevel)))
                + ((balltype === "poison" || balltype === "cash") ? basestat - 1 : 0))
                * ((balltype !== "poison" && balltype !== "cash") ? basestat : 1);
            var power = (powerBase
                * settings["prestige_power"]
                * ((settings["cards_power_active"]) ? settings["cards_power_value"] : 1)
                * ((settings["cards_qc_active"]) ? settings["cards_qc_value"] : 1)
                * (((balltype === "poison" || balltype === "cash") && settings["cards_spec_active"]) ? settings["cards_spec_value"] : 1)
                * ((settings["perks_power"] > 1) ? settings["perks_power"] : 1)
                * ((settings["boosts_ph"]) ? 3 : 1)
                * ((speedLevel > 40) ? 5 : 1)
                * ((speedLevel > 80) ? 5 : 1)
                * (1 + (settings["badges_" + tabs[slot + '_type']] * 0.2))
                * SkillsTreeModifier(balltype, "power"));
			return power;
		}
		
		function CalculateCost(slot) {
            var amountLevel = tabs[slot + '_amount'];
            var speedLevel = tabs[slot + '_speedLevel'];
            var powerLevel = tabs[slot + '_powerLevel'];
		
            var ballcostmod = (1 + (settings["prestige_ballCost"] / 100)) * (1 + (settings["perks_ballCost"] / 100));
            var speedcostmod = (1 + (settings["prestige_speedCost"] / 100)) * (1 + (settings["perks_speedCost"] / 100));
            var powercostmod = (1 + (settings["prestige_powerCost"] / 100)) * (1 + (settings["perks_powerCost"] / 100));
    
            var sumballcost = 0;
            for (var i = 0; i < amountLevel; i++) {
                sumballcost += basecosts[slot]["ball"] * Math.pow(1.9, i)
            }
    
            var sumspeedcost = 0;
            for (var i = 0; i < speedLevel; i++) {
                sumspeedcost += basecosts[slot]["speed"] * Math.pow(1.9, i)
            }
    
            var sumpowercost = 0;
            for (var i = 0; i < powerLevel; i++) {
                sumpowercost += basecosts[slot]["power"] * Math.pow(1.9, i)
            }
    
            var buycost = basecosts[slot]["buy"];
            var ballcost = ((amountLevel > 0) ? sumballcost * ballcostmod : 0);
            var speedcost = ((speedLevel > 0) ? sumspeedcost * speedcostmod : 0);
            var powercost = ((powerLevel > 0) ? sumpowercost * powercostmod : 0);
            var prestige1cost = ((speedLevel > 40) ? basecosts[slot]["speed"] * Math.pow(1.9, 38) * 9.49 : 0) * speedcostmod;
            var prestige2cost = ((speedLevel > 80) ? basecosts[slot]["speed"] * Math.pow(1.9, 78) * 9.49 : 0) * speedcostmod;
            var cost = buycost + ballcost + speedcost + powercost + prestige1cost + prestige2cost;
            return cost;
		}

        function SkillsTreeModifier(balltype, stat) {
            var key = 'skillstree_' + balltype + '_' + stat;
            if (Object.keys(settings).includes(key)){
                return settings[key];
            }

            return 1;
        }
		
		function CalculateDamageWithPoison(otherpower) {		
			var poisonSlot = null;
			for (var i in slots) {
				if (tabs[slots[i] + "_type"] === "poison") {
					poisonSlot = slots[i];
					$('#header_dmg_poison').html("Damage w/<br>" + poisonSlot + " Poison");
					if (poisonSlot === "7500") {
						$('#header_dmg_poison').html("Damage w/<br>7.5k Poison");
					}
					
					break;
				}
            }
			
			if (poisonSlot === null) {
				$('#header_dmg_poison').html("Damage w/<br>?? Poison");
				return null;
			}
			
			var poisonDamage = CalculatePower("poison", poisonSlot);
			var damage = otherpower * poisonDamage * ((settings["cards_catalyst_active"]) ? settings["cards_catalyst_value"] : 1);
			return damage;
		}
		
		function CalculateLastBrickLevel(balldamage) {
			// Find first brick level where balldamage < brick health
			var nexthealthjump = null;
			for (var i in brickmult) {
				var health = Math.pow(brickmult[i]["level"], 1.32) * brickmult[i]["cumulative"];
				if (balldamage < health) {
					nexthealthjump = i;
					break;
				}
			}
			
			// If none found -> over 200k
			if (nexthealthjump === null) {
				var level = Math.pow(balldamage / brickmult[brickmult.length - 1]["cumulative"], 1/1.32);
				return level;
			}
			
			// Check if balldamage > previous brick health
			var previoushealth = Math.pow(brickmult[nexthealthjump]["level"] - 1, 1.32) * brickmult[nexthealthjump - 1]["cumulative"];
			if (balldamage > previoushealth) {
				// If greater -> next level - 1 (balldamage between first and previous health)
				var level = brickmult[nexthealthjump]["level"] - 1;
				return level;
			}
			else {
				// If smaller -> use cumulative of previous level
				var level = Math.pow(balldamage / brickmult[nexthealthjump - 1]["cumulative"], 1/1.32);
				return level;				
			}
		}
    </script>
    
    <body onload="BuildStatsCalculator()">
        <ul class="horizontal">
            <li>
                <a href="index.html">Home</a>
            </li>
            <li>
                <a class="active" href="IBBStatsCalculator.html">IBB Stats Calculator</a>
            </li>
            <li>
                <a href="settings.html">Settings</a>
            </li>
        </ul>
        <div class="text-center">
			<table class="table table-dark table-hover table-right" style="width: 950px;">
				<thead>
					<th style="width: 50px">Slot</th>
					<th style="width: 110px">Ball Type</th>
					<th style="width: 55px">Nr. Balls</th>
					<th style="width: 55px">Ball Speed</th>
					<th style="width: 55px">Ball Power</th>
					<th style="width: 75px">Speed</th>
					<th style="width: 75px">Power</th>
					<th style="width: 75px">Cost</th>
					<th style="width: 100px" id="header_dmg_poison">Damage w/<br>?? Poison</th>
					<th style="width: 100px">Last 1shot<br>Brick Level</th>
					<th style="width: 100px">Last 1shot<br>Hex Level</th>
					<th style="width: 100px">Last 1shot<br>Shield Hex</th>
				</thead>
				<tr>
					<th>Base</th>
					<td>
						<select id="base_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="basic">Basic</option>
						</select>
					</td>
					<td><input type="number" id="base_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="base_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="base_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="base_speed"></td>
					<td id="base_power"></td>
					<td id="base_cost"></td>
					<td id="base_dmg_poison"></td>
					<td id="base_1shot_brick"></td>
					<td id="base_1shot_hex"></td>
					<td id="base_1shot_shield"></td>
				</tr>
				<tr>
					<th>175</th>
					<td>
						<select id="175_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
						</select>
					</td>
					<td><input type="number" id="175_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="175_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="175_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="175_speed"></td>
					<td id="175_power"></td>
					<td id="175_cost"></td>
					<td id="175_dmg_poison"></td>
					<td id="175_1shot_brick"></td>
					<td id="175_1shot_hex"></td>
					<td id="175_1shot_shield"></td>
				</tr>
				<tr>
					<th>7.5k</th>
					<td>
						<select id="7500_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
						</select>
					</td>
					<td><input type="number" id="7500_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="7500_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="7500_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="7500_speed"></td>
					<td id="7500_power"></td>
					<td id="7500_cost"></td>
					<td id="7500_dmg_poison"></td>
					<td id="7500_1shot_brick"></td>
					<td id="7500_1shot_hex"></td>
					<td id="7500_1shot_shield"></td>
				</tr>
				<tr>
					<th>175K</th>
					<td>
						<select id="175k_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
						</select>
					</td>
					<td><input type="number" id="175k_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="175k_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="175k_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="175k_speed"></td>
					<td id="175k_power"></td>
					<td id="175k_cost"></td>
					<td id="175k_dmg_poison"></td>
					<td id="175k_1shot_brick"></td>
					<td id="175k_1shot_hex"></td>
					<td id="175k_1shot_shield"></td>
				</tr>
				<tr>
					<th>15M</th>
					<td>
						<select id="15m_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
						</select>
					</td>
					<td><input type="number" id="15m_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="15m_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="15m_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="15m_speed"></td>
					<td id="15m_power"></td>
					<td id="15m_cost"></td>
					<td id="15m_dmg_poison"></td>
					<td id="15m_1shot_brick"></td>
					<td id="15m_1shot_hex"></td>
					<td id="15m_1shot_shield"></td>
				</tr>
				<tr>
					<th>400B</th>
					<td>
						<select id="400b_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
							<option value="sword">Sword</option>
							<option value="fire">Fire</option>
							<option value="lightning">Lightning</option>
						</select>
					</td>
					<td><input type="number" id="400b_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="400b_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="400b_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="400b_speed"></td>
					<td id="400b_power"></td>
					<td id="400b_cost"></td>
					<td id="400b_dmg_poison"></td>
					<td id="400b_1shot_brick"></td>
					<td id="400b_1shot_hex"></td>
					<td id="400b_1shot_shield"></td>
				</tr>
				<tr>
					<th>10q</th>
					<td>
						<select id="10q_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
							<option value="sword">Sword</option>
							<option value="fire">Fire</option>
							<option value="lightning">Lightning</option>
						</select>
					</td>
					<td><input type="number" id="10q_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="10q_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="10q_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="10q_speed"></td>
					<td id="10q_power"></td>
					<td id="10q_cost"></td>
					<td id="10q_dmg_poison"></td>
					<td id="10q_1shot_brick"></td>
					<td id="10q_1shot_hex"></td>
					<td id="10q_1shot_shield"></td>
				</tr>
				<tr>
					<th>10s</th>
					<td>
						<select id="10s_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
							<option value="sword">Sword</option>
							<option value="fire">Fire</option>
							<option value="lightning">Lightning</option>
						</select>
					</td>
					<td><input type="number" id="10s_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="10s_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="10s_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="10s_speed"></td>
					<td id="10s_power"></td>
					<td id="10s_cost"></td>
					<td id="10s_dmg_poison"></td>
					<td id="10s_1shot_brick"></td>
					<td id="10s_1shot_hex"></td>
					<td id="10s_1shot_shield"></td>
				</tr>
				<tr>
					<th>100O</th>
					<td>
						<select id="100o_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
							<option value="sword">Sword</option>
							<option value="fire">Fire</option>
							<option value="lightning">Lightning</option>
						</select>
					</td>
					<td><input type="number" id="100o_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="100o_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="100o_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="100o_speed"></td>
					<td id="100o_power"></td>
					<td id="100o_cost"></td>
					<td id="100o_dmg_poison"></td>
					<td id="100o_1shot_brick"></td>
					<td id="100o_1shot_hex"></td>
					<td id="100o_1shot_shield"></td>
				</tr>
				<tr>
					<th>5aa</th>
					<td>
						<select id="5aa_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
							<option value="sword">Sword</option>
							<option value="fire">Fire</option>
							<option value="lightning">Lightning</option>
						</select>
					</td>
					<td><input type="number" id="5aa_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="5aa_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="5aa_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="5aa_speed"></td>
					<td id="5aa_power"></td>
					<td id="5aa_cost"></td>
					<td id="5aa_dmg_poison"></td>
					<td id="5aa_1shot_brick"></td>
					<td id="5aa_1shot_hex"></td>
					<td id="5aa_1shot_shield"></td>
				</tr>
				<tr>
					<th>80ac</th>
					<td>
						<select id="80ac_type" onchange="handleCalculatorChange(event)">
							<option value="null"></option>
							<option value="sniper">Sniper</option>
							<option value="splash">Splash</option>
							<option value="poison">Poison</option>
							<option value="demo">Demo</option>
							<option value="scatter">Scatter</option>
							<option value="pierce">Pierce</option>
							<option value="cash">Cash</option>
							<option value="sword">Sword</option>
							<option value="fire">Fire</option>
							<option value="lightning">Lightning</option>
						</select>
					</td>
					<td><input type="number" id="80ac_amount" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="80ac_speedLevel" onchange="handleCalculatorChange(event)" /></td>
					<td><input type="number" id="80ac_powerLevel" onchange="handleCalculatorChange(event)" /></td>
					<td id="80ac_speed"></td>
					<td id="80ac_power"></td>
					<td id="80ac_cost"></td>
					<td id="80ac_dmg_poison"></td>
					<td id="80ac_1shot_brick"></td>
					<td id="80ac_1shot_hex"></td>
					<td id="80ac_1shot_shield"></td>
				</tr>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td id="totalcost"></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</table>
            <table class="table table-dark table-hover" style="width: 320px;">
                <thead>
                    <th style="width: 120px;">Cards</th>
                    <th style="width: 40px">Value</th>
                    <th style="width: 20px">Active?</th>
                </thead>
                <tr>
                    <td>Quality Control</td>
                    <td><input type="number" id="cards_qc_value" onchange="handleSettingsChange(event)" /></td>
                    <td><input type="checkbox" id="cards_qc_active" onchange="handleSettingsChange(event)" /></td>
                </tr>
                <thead>
                    <th>Perks</th>
                    <th>Value</th>
                    <th></th>
                </thead>
                <tr>
                    <td>Ball Speed</td>
                    <td><input type="number" id="perks_speed" onchange="handleSettingsChange(event)" /></td>
                </tr>
                <tr>
                    <td>Ball Power</td>
                    <td><input type="number" id="perks_power" onchange="handleSettingsChange(event)" /></td>
                </tr>
                <thead>
                    <th>Boosts</th>
                    <th></th>
                    <th>Active?</th>
                </thead>
                <tr>
                    <td>Power Hungry</td>
                    <td></td>
                    <td><input type="checkbox" id="boosts_ph" onchange="handleSettingsChange(event)" /></td>
                </tr>
            </table>
        </div>
    </body>
</html>